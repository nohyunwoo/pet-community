<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>커뮤니티</title>
  <link rel="stylesheet" href="/nav.css">
  <link rel="stylesheet" href="/profile.css">
</head>
<body>
  <div th:replace="nav :: navbar"></div>

  <main>
    <div class="container">

      <div class="profile-card">
        <div class="profile-image-section">
          <img th:src="@{/upload/{image}(image=${profile != null && profile.profileImage != null ? profile.profileImage : 'default-profile.png'})}"
               alt="프로필 이미지"
               class="profile-image">
        </div>
        <div class="profile-info-section">
          <div class="profile-username" th:text="${user.username}">사용자 이름</div>
          <div class="profile-detail">
            <span class="profile-detail-label">생년월일:</span>
            <span th:text="${#temporals.format(user.userDate, 'yyyy년 MM월 dd일')}">1990년 01월 01일</span>
          </div>
          <div class="profile-detail">
            <span class="profile-detail-label">가입일:</span>
            <span th:text="${#temporals.format(user.regDate, 'yyyy년 MM월 dd일')}">2024년 12월 21일</span>
          </div>
          <div class="profile-bio">
            <div class="bio-label">자기소개</div>
            <div class="bio-text" th:if="${profile != null && profile.bio != null && !profile.bio.isEmpty()}"
                 th:text="${profile.bio}">
              안녕하세요! 강아지를 사랑하는 집사입니다.
            </div>
            <div class="bio-text bio-empty" th:if="${profile == null || profile.bio == null || profile.bio.isEmpty()}">
              자기소개가 없습니다.
            </div>
          </div>
        </div>
      </div>

      <!-- 내 게시글 섹션 -->
      <div class="my-posts-section">
        <div class="section-header">내가 쓴 게시글</div>

        <div class="post-list">
          <div th:if="${posts != null && posts.totalElements > 0}">
            <div th:each="post, iterStat : ${posts.content}" class="post-item" th:onclick="'location.href=\'/post/' + ${post.id} + '\''">
              <span class="post-number" th:text="${posts.totalElements - (posts.number * posts.size) - iterStat.index}">1</span>
              <div class="post-info">
                <span class="post-category" th:text="${post.category}">자유</span>
                <a class="post-title-text" th:href="@{'/post/' + ${post.id}}" th:text="${post.title}">게시글 제목</a>
              </div>
              <div class="post-meta">
                <span class="post-date" th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">2024.12.21</span>
                <span class="post-views" th:text="'조회 ' + ${post.count}">조회 128</span>
              </div>
            </div>
          </div>

          <div th:if="${posts == null || posts.totalElements == 0}">
            <p class="empty-message">작성한 게시글이 없습니다.</p>
          </div>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination" th:if="${posts != null and posts.totalPages > 0}">
          <!-- 이전 버튼 -->
          <button class="page-btn"
                  th:if="${posts.number > 0}"
                  th:onclick="'location.href=\'/profile?page=' + (${posts.number} - 1) + '&size=' + ${posts.size} + '\''">
            이전
          </button>

          <!-- 페이지 번호 버튼 -->
          <th:block th:each="i : ${#numbers.sequence(0, posts.totalPages - 1)}">
            <button class="page-btn"
                    th:classappend="${i == posts.number} ? 'active' : ''"
                    th:onclick="'location.href=\'/profile?page=' + ${i} + '&size=' + ${posts.size} + '\''"
                    th:text="${i + 1}">
            </button>
          </th:block>

          <!-- 다음 버튼 -->
          <button class="page-btn"
                  th:if="${posts.number < posts.totalPages - 1}"
                  th:onclick="'location.href=\'/profile?page=' + (${posts.number} + 1) + '&size=' + ${posts.size} + '\''">
            다음
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // 페이지네이션
    document.querySelectorAll('.page-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
            if (!isNaN(this.textContent)) {
                this.classList.add('active');
            }
        });
    });
  </script>
</body>
</html>